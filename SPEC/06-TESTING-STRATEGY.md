# æµ‹è¯•ç­–ç•¥ (Testing Strategy)

## ç‰ˆæœ¬ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0
- **æœ€åæ›´æ–°**: 2025-12-24
- **çŠ¶æ€**: Active
- **å˜æ›´è¯´æ˜**: å®šä¹‰100%ç²¾ç¡®å¤åˆ»Cç‰ˆæœ¬æµ‹è¯•çš„å®Œæ•´è§„èŒƒ

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰ zip-rs é¡¹ç›®çš„æµ‹è¯•ç­–ç•¥ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯**å®Œæ•´å¤åˆ» C ç‰ˆæœ¬çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹**ï¼Œç¡®ä¿ Rust å®ç°ä¸ C ç‰ˆæœ¬è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚

### æµ‹è¯•ç›®æ ‡

| ç›®æ ‡ | è¯´æ˜ |
|------|------|
| åŠŸèƒ½å¯¹ç­‰ | 100% å¤åˆ» C ç‰ˆæœ¬æµ‹è¯•ç”¨ä¾‹ |
| è¡Œä¸ºä¸€è‡´ | æœŸæœ›ç»“æœä¸ C ç‰ˆæœ¬å®Œå…¨ç›¸åŒ |
| çº¯ Rust å®ç° | ç¦æ­¢ FFI è°ƒç”¨ C å‡½æ•°ç”¨äºæµ‹è¯•éªŒè¯ |
| æµ‹è¯•è¦†ç›– | æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½è·¯å¾„å‡æœ‰æµ‹è¯•è¦†ç›– |

### 100%ç²¾ç¡®å¤åˆ»æ ‡å‡†

| å¤åˆ»ç»´åº¦ | Cç‰ˆæœ¬å®ç° | Rustç‰ˆæœ¬è¦æ±‚ | éªŒè¯æ–¹å¼ |
|---------|----------|-------------|---------|
| **æµ‹è¯•æ•°æ®** | 203å­—èŠ‚å›ºå®šå‹ç¼©æ•°æ® | å­—èŠ‚çº§å®Œå…¨ç›¸åŒ | åŸå§‹å­—èŠ‚å¯¹æ¯” |
| **å‡½æ•°ç­¾å** | `inflate(buffer, pos, size)` | å®Œå…¨ç›¸åŒå‚æ•° | ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ |
| **å‚æ•°ä¼ é€’** | `pos`èµ·å§‹ä½ç½®ã€`size`ç¼“å†²åŒºå¤§å° | å®Œå…¨ç›¸åŒè¯­ä¹‰ | å•å…ƒæµ‹è¯•è¦†ç›– |
| **è¿”å›å€¼** | `list(output, bytes_read, bytes_written)` | å‘½åç»“æ„ä½“ | å­—æ®µå®Œå…¨å¯¹åº” |
| **è¿›ç¨‹API** | `zip_process()$new()` è°ƒç”¨å¤–éƒ¨å·¥å…· | çœŸå®è¿›ç¨‹è°ƒç”¨CLI | è¿›ç¨‹é€€å‡ºç éªŒè¯ |
| **å¿«ç…§æµ‹è¯•** | `expect_snapshot(cat(out))` | `insta::assert_snapshot!` | å¿«ç…§æ–‡ä»¶å¯¹æ¯” |
| **é”™è¯¯éªŒè¯** | `expect_snapshot(error=TRUE)` | é”™è¯¯å¿«ç…§åŒ¹é… | é”™è¯¯æ¶ˆæ¯å®Œå…¨ä¸€è‡´ |
| **è¾…åŠ©å‡½æ•°** | `make_a_zip()` ç­‰ | å®Œå…¨å¯¹åº”å®ç° | æµ‹è¯•ç»“æœå¯¹æ¯” |

---

## æµ‹è¯•æ–‡ä»¶æ˜ å°„

### C ç‰ˆæœ¬ â†’ Rust ç‰ˆæœ¬æµ‹è¯•æ–‡ä»¶å¯¹ç…§è¡¨

| C ç‰ˆæœ¬æµ‹è¯•æ–‡ä»¶ | Rust ç‰ˆæœ¬æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ |
|---------------|------------------|---------|
| testthat/test-inflate.R | tests/inflate.rs | INFLATE è§£å‹ç®—æ³• |
| testthat/test-zip.R | tests/zip.rs | å•æ–‡ä»¶/å¤šæ–‡ä»¶å‹ç¼© |
| testthat/test-unzip.R | tests/unzip.rs | è§£å‹åŠŸèƒ½ï¼ˆå…¨éƒ¨/éƒ¨åˆ†ï¼‰ |
| testthat/test-zip-list.R | tests/zip_list.rs | ZIP åˆ—è¡¨åŠŸèƒ½ |
| testthat/test-errors.R | tests/errors.rs | é”™è¯¯å¤„ç† |
| testthat/test-paths.R | tests/paths.rs | è·¯å¾„å¤„ç† |
| testthat/test-special-dot.R | tests/special_dot.rs | ç‰¹æ®Šç‚¹è·¯å¾„å¤„ç† |
| testthat/test-weird-paths.R | tests/weird_paths.rs | å¥‡æ€ªè·¯å¾„å¤„ç† |
| testthat/test-large-files.R | tests/large_files.rs | å¤§æ–‡ä»¶å¤„ç† |
| testthat/test-zip-process.R | tests/zip_process.rs | zip è¿›ç¨‹è°ƒç”¨ |
| testthat/test-unzip-process.R | tests/unzip_process.rs | unzip è¿›ç¨‹è°ƒç”¨ |
| testthat/test-zipr.R | tests/zipr.rs | zipr å‘½ä»¤è¡Œå·¥å…· |
| testthat/test-get-zip-data.R | tests/get_zip_data.rs | è·å– ZIP æ•°æ® |
| testthat/test-get-zip-data-path.R | tests/get_zip_data_path.rs | è·å– ZIP æ•°æ®è·¯å¾„ |
| testthat/helper.R | tests/common.rs | å…¬å…±æµ‹è¯•è¾…åŠ©å‡½æ•° |

### åºŸé™¤çš„æµ‹è¯•

| æµ‹è¯•ç›®å½• | å¤„ç†æ–¹å¼ | åŸå›  |
|---------|---------|------|
| tests/ffi/ | åˆ é™¤ | FFI è°ƒç”¨æ–¹å¼å¯¼è‡´æ®µé”™è¯¯ï¼Œæ”¹ç”¨çº¯ Rust å®ç°éªŒè¯ |

---

## æµ‹è¯•ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ common.rs              # å…¬å…±æµ‹è¯•è¾…åŠ©å‡½æ•°
â”œâ”€â”€ inflate.rs             # INFLATE ç®—æ³•æµ‹è¯•
â”œâ”€â”€ zip.rs                 # ZIP å‹ç¼©åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ unzip.rs               # UNZIP è§£å‹åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ zip_list.rs            # ZIP åˆ—è¡¨åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ errors.rs              # é”™è¯¯å¤„ç†æµ‹è¯•
â”œâ”€â”€ paths.rs               # è·¯å¾„å¤„ç†æµ‹è¯•
â”œâ”€â”€ special_dot.rs         # ç‰¹æ®Šç‚¹è·¯å¾„æµ‹è¯•
â”œâ”€â”€ weird_paths.rs         # å¥‡æ€ªè·¯å¾„æµ‹è¯•
â”œâ”€â”€ large_files.rs         # å¤§æ–‡ä»¶æµ‹è¯•
â”œâ”€â”€ zip_process.rs         # zip è¿›ç¨‹æµ‹è¯•
â”œâ”€â”€ unzip_process.rs       # unzip è¿›ç¨‹æµ‹è¯•
â”œâ”€â”€ zipr.rs                # zipr å‘½ä»¤è¡Œæµ‹è¯•
â”œâ”€â”€ get_zip_data.rs        # è·å– ZIP æ•°æ®æµ‹è¯•
â””â”€â”€ get_zip_data_path.rs   # è·å– ZIP æ•°æ®è·¯å¾„æµ‹è¯•

src/miniz/
â””â”€â”€ tests/                 # å•å…ƒæµ‹è¯•ï¼ˆå·²å­˜åœ¨ï¼‰
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ adler32.rs
    â”œâ”€â”€ bitstream.rs
    â”œâ”€â”€ crc32.rs
    â”œâ”€â”€ deflate.rs
    â”œâ”€â”€ huffman.rs
    â””â”€â”€ inflate.rs
```

---

## æµ‹è¯•ç”¨ä¾‹æ¸…å•

### TEST-INFLATE-001: åŸºç¡€ INFLATE è§£å‹

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/inflate.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-inflate.R |
| æµ‹è¯•æ•°æ® | å›ºå®šçš„å‹ç¼©å­—èŠ‚åºåˆ— |
| éªŒè¯å†…å®¹ | è§£å‹ç»“æœä¸æœŸæœ›å€¼ä¸€è‡´ |
| æµ‹è¯•æ•°é‡ | 1+ |

### TEST-ZIP-001: å•æ–‡ä»¶å‹ç¼©

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/zip.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-zip.R |
| æµ‹è¯•åœºæ™¯ | å‹ç¼©å•ä¸ªæ–‡ä»¶ |
| éªŒè¯å†…å®¹ | ZIP æ–‡ä»¶å­˜åœ¨ã€æ–‡ä»¶åˆ—è¡¨æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-ZIP-002: å¤šæ–‡ä»¶å‹ç¼©

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/zip.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-zip.R |
| æµ‹è¯•åœºæ™¯ | å‹ç¼©å¤šä¸ªæ–‡ä»¶ |
| éªŒè¯å†…å®¹ | æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨åˆ—è¡¨ä¸­ |
| æµ‹è¯•æ•°é‡ | 2+ |

### TEST-ZIP-003: ç›®å½•å‹ç¼©

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/zip.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-zip.R |
| æµ‹è¯•åœºæ™¯ | å‹ç¼©åŒ…å«æ–‡ä»¶çš„ç›®å½• |
| éªŒè¯å†…å®¹ | ç›®å½•ç»“æ„å’Œæ–‡ä»¶éƒ½æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-UNZIP-001: è§£å‹æ‰€æœ‰æ–‡ä»¶

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/unzip.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-unzip.R |
| æµ‹è¯•åœºæ™¯ | è§£å‹ ZIP ä¸­çš„æ‰€æœ‰æ–‡ä»¶ |
| éªŒè¯å†…å®¹ | æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•éƒ½æ­£ç¡®åˆ›å»º |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-UNZIP-002: è§£å‹æŒ‡å®šæ–‡ä»¶

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/unzip.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-unzip.R |
| æµ‹è¯•åœºæ™¯ | åªè§£å‹ ZIP ä¸­çš„æŒ‡å®šæ–‡ä»¶ |
| éªŒè¯å†…å®¹ | åªæœ‰æŒ‡å®šæ–‡ä»¶è¢«è§£å‹ |
| æµ‹è¯•æ•°é‡ | 2+ |

### TEST-ZIP-LIST-001: åˆ—å‡º ZIP å†…å®¹

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/zip_list.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-zip-list.R |
| æµ‹è¯•åœºæ™¯ | è·å– ZIP æ–‡ä»¶å†…å®¹åˆ—è¡¨ |
| éªŒè¯å†…å®¹ | æ–‡ä»¶åã€å¤§å°ã€æ—¶é—´æˆ³æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-ERRORS-001: é”™è¯¯å¤„ç†

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/errors.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-errors.R |
| æµ‹è¯•åœºæ™¯ | å„ç§é”™è¯¯æƒ…å†µ |
| éªŒè¯å†…å®¹ | é”™è¯¯ç ä¸ C ç‰ˆæœ¬ä¸€è‡´ |
| æµ‹è¯•æ•°é‡ | 5+ |

### TEST-PATHS-001: è·¯å¾„å¤„ç†

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/paths.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-paths.R |
| æµ‹è¯•åœºæ™¯ | å„ç§è·¯å¾„æ ¼å¼ |
| éªŒè¯å†…å®¹ | è·¯å¾„æ­£ç¡®å¤„ç†å’Œå­˜å‚¨ |
| æµ‹è¯•æ•°é‡ | 5+ |

### TEST-SPECIAL-DOT-001: ç‰¹æ®Šç‚¹è·¯å¾„

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/special_dot.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-special-dot.R |
| æµ‹è¯•åœºæ™¯ | åŒ…å« `.` çš„è·¯å¾„ |
| éªŒè¯å†…å®¹ | ç‚¹è·¯å¾„æ­£ç¡®å¤„ç† |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-WEIRD-PATHS-001: å¥‡æ€ªè·¯å¾„

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/weird_paths.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-weird-paths.R |
| æµ‹è¯•åœºæ™¯ | éå¸¸è§„è·¯å¾„æ ¼å¼ |
| éªŒè¯å†…å®¹ | ç‰¹æ®Šè·¯å¾„ä¸å¯¼è‡´å´©æºƒ |
| æµ‹è¯•æ•°é‡ | 5+ |

### TEST-LARGE-FILES-001: å¤§æ–‡ä»¶å¤„ç†

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/large_files.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-large-files.R |
| æµ‹è¯•åœºæ™¯ | è¶…è¿‡ 4GB çš„æ–‡ä»¶ |
| éªŒè¯å†…å®¹ | ZIP64 æ ¼å¼æ­£ç¡®å¤„ç† |
| æµ‹è¯•æ•°é‡ | 2+ |

### TEST-ZIP-PROCESS-001: è¿›ç¨‹è°ƒç”¨

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/zip_process.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-zip-process.R |
| æµ‹è¯•åœºæ™¯ | é€šè¿‡è¿›ç¨‹è°ƒç”¨ zip åŠŸèƒ½ |
| éªŒè¯å†…å®¹ | è¿›ç¨‹è°ƒç”¨è¿”å›æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-UNZIP-PROCESS-001: è§£å‹è¿›ç¨‹

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/unzip_process.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-unzip-process.R |
| æµ‹è¯•åœºæ™¯ | é€šè¿‡è¿›ç¨‹è°ƒç”¨ unzip åŠŸèƒ½ |
| éªŒè¯å†…å®¹ | è¿›ç¨‹è°ƒç”¨è¿”å›æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-ZIPR-001: å‘½ä»¤è¡Œå·¥å…·

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/zipr.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-zipr.R |
| æµ‹è¯•åœºæ™¯ | zipr å‘½ä»¤è¡Œå·¥å…·åŠŸèƒ½ |
| éªŒè¯å†…å®¹ | å‘½ä»¤è¡Œå‚æ•°å¤„ç†æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 5+ |

### TEST-GET-ZIP-DATA-001: è·å–æ•°æ®

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/get_zip_data.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-get-zip-data.R |
| æµ‹è¯•åœºæ™¯ | ä» ZIP è¯»å–æ•°æ® |
| éªŒè¯å†…å®¹ | è¯»å–çš„æ•°æ®ä¸åŸå§‹ä¸€è‡´ |
| æµ‹è¯•æ•°é‡ | 3+ |

### TEST-GET-ZIP-DATA-PATH-001: æ•°æ®è·¯å¾„

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| æµ‹è¯•æ–‡ä»¶ | tests/get_zip_data_path.rs |
| C ç‰ˆæœ¬ä½ç½® | testthat/test-get-zip-data-path.R |
| æµ‹è¯•åœºæ™¯ | è·å– ZIP æ•°æ®è·¯å¾„ |
| éªŒè¯å†…å®¹ | è¿”å›çš„è·¯å¾„æ­£ç¡® |
| æµ‹è¯•æ•°é‡ | 2+ |

---

## æµ‹è¯•æ•°æ®è§„èŒƒ

### æ•°æ®æ¥æºè§„åˆ™

| æ•°æ®ç±»å‹ | æ¥æºè§„åˆ™ |
|---------|---------|
| å‹ç¼©æµ‹è¯•æ•°æ® | ç›´æ¥ä» C ç‰ˆæœ¬æµ‹è¯•æ–‡ä»¶å¤åˆ¶å­—èŠ‚åºåˆ— |
| æ–‡ä»¶å†…å®¹æµ‹è¯• | ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦ä¸²å†…å®¹ |
| è·¯å¾„æµ‹è¯•æ•°æ® | ä½¿ç”¨ç›¸åŒçš„è·¯å¾„æ ¼å¼ |
| å¤§å°æµ‹è¯•æ•°æ® | ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶å¤§å° |

### æ•°æ®å¯¹ç­‰éªŒè¯

| éªŒè¯é¡¹ | æ–¹æ³• |
|--------|------|
| è¾“å…¥æ•°æ® | ä¸ C ç‰ˆæœ¬æµ‹è¯•æ•°æ®å­—èŠ‚çº§ä¸€è‡´ |
| æœŸæœ›è¾“å‡º | ä¸ C ç‰ˆæœ¬æœŸæœ›å€¼å®Œå…¨ç›¸åŒ |
| é”™è¯¯ç  | é”™è¯¯ç æ•°å€¼ä¸ C ç‰ˆæœ¬å¯¹åº” |
| æ–‡ä»¶ç»“æ„ | ZIP å†…éƒ¨ç»“æ„æ ¼å¼ä¸€è‡´ |

---

## æµ‹è¯•å®ç°è§„èŒƒ

### æ¶æ„ç»„ä»¶

| ç»„ä»¶ | Cç‰ˆæœ¬ | Rustç‰ˆæœ¬ | å®ç°ä½ç½® |
|------|-------|----------|---------|
| **CLIå·¥å…·** | cmdzip/cmdunzipå¯æ‰§è¡Œæ–‡ä»¶ | ziprs-rs CLI | src/bin/ |
| **è¿›ç¨‹API** | processx::processå­ç±» | std::process::CommandåŒ…è£… | src/process/ |
| **å¿«ç…§æµ‹è¯•** | testthat expect_snapshot | insta crate | tests/ |
| **è¾…åŠ©å‡½æ•°** | helper.R | tests/common.rs | tests/ |
| **æµ‹è¯•æ•°æ®** | å›ºå®šå­—èŠ‚åºåˆ— | const TEST_DATA | tests/*.rs |

### CLIå·¥å…·æ¶æ„

**Cç‰ˆæœ¬å®ç°**ï¼š
- RåŒ…è°ƒç”¨å¤–éƒ¨å¯æ‰§è¡Œæ–‡ä»¶ `cmdzip.exe` / `cmdunzip.exe`
- é€šè¿‡å‚æ•°æ–‡ä»¶ä¼ é€’é…ç½®
- è¿›ç¨‹é—´é€šä¿¡ï¼šå‘½ä»¤è¡Œå‚æ•° + é€€å‡ºç 

**Rustç‰ˆæœ¬å®ç°**ï¼ˆæ–¹æ¡ˆAï¼šçœŸå®è¿›ç¨‹ï¼‰ï¼š

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| **å¯æ‰§è¡Œæ–‡ä»¶** | src/bin/ziprs.rs, src/bin/unziprs.rs |
| **è¿›ç¨‹å¯åŠ¨** | std::process::Command |
| **å‚æ•°ä¼ é€’** | å‘½ä»¤è¡Œå‚æ•°ï¼ˆä¸Cç‰ˆæœ¬ç›¸åŒçš„è¯­ä¹‰ï¼‰ |
| **é€€å‡ºç ** | 0=æˆåŠŸï¼Œé0=å¤±è´¥ |
| **è¾“å‡º** | stdoutç”¨äºæ•°æ®ï¼Œstderrç”¨äºé”™è¯¯ |

**CLIå‘½ä»¤æ ¼å¼**ï¼š

```
ziprs <zipfile> <params-file>
unziprs <zipfile> <exdir>
```

### è¿›ç¨‹APIæ¶æ„

**Cç‰ˆæœ¬**ï¼š
```r
zip_process()$new(zipfile, files, recurse, include_directories)
```

**Rustç‰ˆæœ¬ç­‰ä»·**ï¼š

| ç±»å‹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| ZipProcess | new(zipfile, files, options) | åˆ›å»ºZIPè¿›ç¨‹ |
| ZipProcess | wait(timeout) | ç­‰å¾…è¿›ç¨‹å®Œæˆ |
| ZipProcess | kill() | ç»ˆæ­¢è¿›ç¨‹ |
| ZipProcess | get_exit_status() | è·å–é€€å‡ºç  |
| UnzipProcess | new(zipfile, exdir) | åˆ›å»ºUNZIPè¿›ç¨‹ |
| UnzipProcess | wait(timeout) | ç­‰å¾…è¿›ç¨‹å®Œæˆ |
| UnzipProcess | get_exit_status() | è·å–é€€å‡ºç  |

**è¿›ç¨‹åŒ…è£…å™¨ç»“æ„**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| child | std::process::Child | å­è¿›ç¨‹å¥æŸ„ |
| zipfile | PathBuf | ZIPæ–‡ä»¶è·¯å¾„ |
| stderr_file | PathBuf | é”™è¯¯è¾“å‡ºæ–‡ä»¶ |

### å¿«ç…§æµ‹è¯•è§„èŒƒ

**å·¥å…·é€‰æ‹©**ï¼šinsta crate

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| **å¿«ç…§ç›®å½•** | tests/snapshots/ |
| **å¿«ç…§æ‰©å±•å** | .snap |
| **æ›´æ–°å¿«ç…§** | INSTA_UPDATE=always |
| **å·®å¼‚æ˜¾ç¤º** | å½©è‰²diffè¾“å‡º |

**å¿«ç…§å‘½åè§„èŒƒ**ï¼š

| æµ‹è¯•æ–‡ä»¶ | å¿«ç…§æ–‡ä»¶å‘½å |
|---------|-------------|
| tests/inflate.rs | tests/snapshots/inflate__test_inflate.snap |
| tests/zip_process.rs | tests/snapshots/zip_process__zip_process.snap |

**å¿«ç…§å†…å®¹æ ¼å¼**ï¼š

```
---
source: tests/inflate.rs
expression: output
---
<?xml version="1.0" encoding="UTF-8"?>
...
```

### æµ‹è¯•ç¼–å†™çº¦æŸ

| çº¦æŸé¡¹ | è¦æ±‚ |
|--------|------|
| è¯­è¨€ | çº¯ Rustï¼Œç¦æ­¢ FFI è°ƒç”¨ C å‡½æ•° |
| æµ‹è¯•æ¡†æ¶ | ä½¿ç”¨ Rust å†…ç½®çš„ `#[test]` å±æ€§ |
| å¿«ç…§æµ‹è¯• | ä½¿ç”¨ insta::assert_snapshot! |
| æ–­è¨€ | ä½¿ç”¨ assert_eq!, assert! ç­‰ |
| ä¸´æ—¶æ–‡ä»¶ | ä½¿ç”¨ tempfile crate åˆ›å»º |
| æ¸…ç† | ä½¿ç”¨ Drop trait ç¡®ä¿æ¸…ç† |
| è¿›ç¨‹API | å¿…é¡»ä½¿ç”¨çœŸå®è¿›ç¨‹è°ƒç”¨CLI |

### æµ‹è¯•å‘½åè§„èŒƒ

| æµ‹è¯•ç±»å‹ | å‘½åæ ¼å¼ |
|---------|---------|
| åŠŸèƒ½æµ‹è¯• | `test_<åŠŸèƒ½æè¿°>` |
| é”™è¯¯æµ‹è¯• | `test_error_<é”™è¯¯ç±»å‹>` |
| è¾¹ç•Œæµ‹è¯• | `test_<è¾¹ç•Œåœºæ™¯>` |

### æµ‹è¯•è¾…åŠ©å‡½æ•°

| å‡½æ•°ç”¨é€” | ä½ç½® | Cç‰ˆæœ¬å¯¹åº” |
|---------|------|----------|
| ä¸´æ—¶ç›®å½•åˆ›å»º | tests/common.rs | test_temp_dir() |
| æµ‹è¯•æ–‡ä»¶ç”Ÿæˆ | tests/common.rs | test_temp_file() |
| ZIPåˆ›å»ºè¾…åŠ© | tests/common.rs | make_a_zip() |
| æ•°æ®æ¯”è¾ƒ | tests/common.rs | N/A |
| è·¯å¾„æ ‡å‡†åŒ– | tests/common.rs | transform_tempdir() |

---

## å‡½æ•°ç­¾åè§„èŒƒ

### inflate/deflate å‡½æ•°

**Cç‰ˆæœ¬ç­¾å**ï¼š
```r
inflate(buffer, pos = 1L, size = NULL)
deflate(buffer, level = 6L, pos = 1L, size = NULL)
```

**Rustç‰ˆæœ¬ç­¾å**ï¼š

| å‚æ•° | ç±»å‹ | è¯´æ˜ | Cç‰ˆæœ¬å¯¹åº” |
|------|------|------|----------|
| buffer | &[u8] | è¾“å…¥æ•°æ® | buffer (raw) |
| pos | i32 | èµ·å§‹ä½ç½®ï¼ˆ1-basedï¼‰ | pos (1L) |
| size | Option<i32> | ç¼“å†²åŒºå¤§å°ä¼°è®¡ | size (NULL/integer) |
| level | i32 | å‹ç¼©çº§åˆ«ï¼ˆ1-9ï¼‰ | level (6L) |

**è¿”å›å€¼ç»“æ„**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | Cç‰ˆæœ¬å¯¹åº” |
|------|------|------|----------|
| output | Vec<u8> | è¾“å‡ºæ•°æ® | output (raw) |
| bytes_read | i32 | è¯»å–çš„å­—èŠ‚æ•° | bytes_read |
| bytes_written | i32 | å†™å…¥çš„å­—èŠ‚æ•° | bytes_written |

**å‚æ•°è¯­ä¹‰**ï¼š

| å‚æ•° | è¯­ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| pos | ä»bufferçš„å“ªä¸ªå­—èŠ‚å¼€å§‹å¤„ç† | pos=1è¡¨ç¤ºä»ç¬¬1ä¸ªå­—èŠ‚å¼€å§‹ |
| size | è¾“å‡ºç¼“å†²åŒºçš„é¢„ä¼°å¤§å° | size=200åˆ†é…200å­—èŠ‚ç¼“å†²åŒº |
| level | å‹ç¼©çº§åˆ«ï¼Œ1æœ€å¿«ï¼Œ9æœ€å¥½ | level=6é»˜è®¤çº§åˆ« |

### è¾¹ç•Œæ¡ä»¶å¤„ç†

| åœºæ™¯ | Cç‰ˆæœ¬è¡Œä¸º | Rustç‰ˆæœ¬è¦æ±‚ |
|------|----------|-------------|
| posè¶…å‡ºèŒƒå›´ | è¿”å›é”™è¯¯ | è¿”å›ç›¸åŒé”™è¯¯ |
| sizeè¿‡å° | è‡ªåŠ¨æ‰©å®¹å¤šæ¬¡ | å®Œå…¨ç›¸åŒçš„æ‰©å®¹è¡Œä¸º |
| size=NULL | ä½¿ç”¨é»˜è®¤å¤§å° | ä½¿ç”¨ç›¸åŒçš„é»˜è®¤å€¼ |
| level<1æˆ–>9 | æŠ›å‡ºé”™è¯¯ | ç¼–è¯‘æœŸ+è¿è¡ŒæœŸæ£€æŸ¥ |

---

## éªŒè¯æ¡ä»¶è§„èŒƒ

### å¿«ç…§æµ‹è¯•æ˜ å°„

| Cç‰ˆæœ¬ | Rustç‰ˆæœ¬ | è¯´æ˜ |
|-------|---------|------|
| expect_snapshot(cat(out)) | insta::assert_snapshot!(out) | è¾“å‡ºå¿«ç…§ |
| expect_snapshot(error=TRUE, expr) | insta::assert_snapshot!(error) | é”™è¯¯å¿«ç…§ |

### æ–­è¨€æ˜ å°„

| Cç‰ˆæœ¬ | Rustç‰ˆæœ¬ | ä½¿ç”¨åœºæ™¯ |
|-------|---------|---------|
| expect_equal(x, y) | assert_eq!(x, y) | å€¼ç›¸ç­‰ |
| expect_true(x) | assert!(x) | å¸ƒå°”çœŸ |
| expect_error(expr) | assert!(expr.is_err()) | é”™è¯¯å‘ç”Ÿ |
| expect_silent(expr) | let _ = expr | æ— é”™è¯¯/è­¦å‘Š |

### è¾“å‡ºéªŒè¯

| éªŒè¯ç±»å‹ | Cç‰ˆæœ¬ | Rustç‰ˆæœ¬ | ç¤ºä¾‹ |
|---------|-------|---------|------|
| æ–‡æœ¬è¾“å‡º | expect_snapshot(cat(out)) | assert_snapshot!(out) | XMLå†…å®¹ |
| äºŒè¿›åˆ¶è¾“å‡º | expect_equal(output, expected) | assert_eq!(output, &expected) | å‹ç¼©æ•°æ® |
| é”™è¯¯æ¶ˆæ¯ | expect_snapshot(error=TRUE) | assert_snapshot!(format!("{:?}", err)) | é”™è¯¯æ ¼å¼ |
| æ–‡ä»¶åˆ—è¡¨ | expect_equal(list$filename, files) | assert_eq!(filenames, files) | ZIPå†…å®¹ |
| è¿›ç¨‹é€€å‡ºç  | expect_equal(p$get_exit_status(), 0L) | assert_eq!(process.get_exit_status(), 0) | è¿›ç¨‹æˆåŠŸ |

### ç‰¹æ®ŠéªŒè¯åœºæ™¯

**UTF-8ç¼–ç å¤„ç†**ï¼š

| åœºæ™¯ | Cç‰ˆæœ¬å¤„ç† | Rustç‰ˆæœ¬è¦æ±‚ |
|------|----------|-------------|
| æ”¯æŒUTF-8 | ä½¿ç”¨UTF-8å˜ä½“å¿«ç…§ | ä½¿ç”¨ç›¸åŒçš„å¿«ç…§å˜ä½“ |
| ä¸æ”¯æŒUTF-8 | iconvè½¬æ¢ä¸ºASCII | ä½¿ç”¨ASCIIå…¼å®¹è¾“å‡º |
| æ··åˆç¼–ç  | å­—èŠ‚çº§æ ‡è®° | ç›¸åŒçš„å­—èŠ‚æ ‡è®° |

**ä¸´æ—¶è·¯å¾„å¤„ç†**ï¼š

| åœºæ™¯ | Cç‰ˆæœ¬ | Rustç‰ˆæœ¬ |
|------|-------|---------|
| è·¯å¾„æ ‡å‡†åŒ– | transform_tempdir() | ç›¸åŒçš„è·¯å¾„æ ‡å‡†åŒ– |
| ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ | <tempdir>, <tempfile> | ç›¸åŒçš„å ä½ç¬¦ |
| å¹³å°å·®å¼‚ | Windows/Unixè·¯å¾„ | ç›¸åŒçš„è·¯å¾„å¤„ç† |

---

---

## æµ‹è¯•è¦†ç›–ç›®æ ‡

### æ¨¡å—è¦†ç›–ç›®æ ‡

| æ¨¡å— | è¦†ç›–ç›®æ ‡ | å½“å‰çŠ¶æ€ |
|------|---------|---------|
| src/miniz/mod.rs (Adler32) | 100% | âœ… å·²å®ç° |
| src/miniz/crc32.rs | 100% | âœ… å·²å®ç° |
| src/miniz/huffman.rs | 100% | âœ… å·²å®ç° |
| src/miniz/deflate.rs | 100% | âœ… å·²å®ç° |
| src/miniz/inflate.rs | 100% | âœ… å·²å®ç° |
| src/miniz/bitstream.rs | 100% | âœ… å·²å®ç° |
| src/gzip/mod.rs | 100% | âœ… å·²å®ç° |
| src/zip/mod.rs | 0% | ğŸš§ å¾…å®ç° |
| src/unzip/mod.rs | 0% | ğŸš§ å¾…å®ç° |
| src/zip/writer.rs | 0% | ğŸš§ å¾…å®ç° |
| src/unzip/archive.rs | 0% | ğŸš§ å¾…å®ç° |

### æµ‹è¯•ç”¨ä¾‹æ€»æ•°ç›®æ ‡

| ç±»åˆ« | C ç‰ˆæœ¬æ•°é‡ | Rust ç›®æ ‡ | å½“å‰çŠ¶æ€ |
|------|-----------|----------|---------|
| å•å…ƒæµ‹è¯• | N/A | 29 | âœ… 29 é€šè¿‡ |
| é›†æˆæµ‹è¯• | ~50 | 50 | ğŸš§ å¾…å®ç° |
| æ€»è®¡ | ~50 | 79 | 37% å®Œæˆ |

---

## æµ‹è¯•æ‰§è¡Œè§„èŒƒ

### æœ¬åœ°æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
cargo test --test zip

# è¿è¡Œç‰¹å®šæµ‹è¯•å‡½æ•°
cargo test test_zip_single_file

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -- --nocapture

# è¯¦ç»†è¾“å‡º
cargo test -- --show-output
```

### CI æµ‹è¯•

| ç¯å¢ƒ | è¦æ±‚ |
|------|------|
| æ“ä½œç³»ç»Ÿ | Linux, macOS, Windows |
| Rust ç‰ˆæœ¬ | Stable, Beta, Nightly |
| æµ‹è¯•é¢‘ç‡ | æ¯æ¬¡ PR å’Œåˆå¹¶ |

---

## æµ‹è¯•å¤±è´¥å¤„ç†

### å¤±è´¥åˆ†ç±»

| å¤±è´¥ç±»å‹ | å¤„ç†æ–¹å¼ |
|---------|---------|
| å®ç°é”™è¯¯ | ä¿®å¤ä»£ç å®ç° |
| æµ‹è¯•é”™è¯¯ | ä¿®å¤æµ‹è¯•ä»£ç  |
| æœŸæœ›å€¼é”™è¯¯ | å¯¹æ¯” C ç‰ˆæœ¬éªŒè¯åæ›´æ–° |
| ç¯å¢ƒé”™è¯¯ | ä¿®å¤æµ‹è¯•ç¯å¢ƒé…ç½® |

### è°ƒè¯•æµç¨‹

```
æµ‹è¯•å¤±è´¥
    â†“
1. è¿è¡Œ C ç‰ˆæœ¬å¯¹åº”æµ‹è¯•ï¼Œè·å–æ­£ç¡®ç»“æœ
    â†“
2. å¯¹æ¯” Rust å’Œ C ç‰ˆæœ¬çš„å·®å¼‚
    â†“
3. å®šä½é—®é¢˜åŸå› ï¼ˆå®ç° vs æµ‹è¯•ï¼‰
    â†“
4. ä¿®å¤é—®é¢˜
    â†“
5. é‡æ–°æµ‹è¯•éªŒè¯
```

---

## æµ‹è¯•è´¨é‡æ ‡å‡†

### é€šè¿‡æ ‡å‡†

| æ ‡å‡† | è¦æ±‚ |
|------|------|
| å•å…ƒæµ‹è¯• | 100% é€šè¿‡ |
| é›†æˆæµ‹è¯• | 100% é€šè¿‡ |
| æµ‹è¯•è¦†ç›– | éå¹³å‡¡ä»£ç  â‰¥ 80% |
| æ— è·³è¿‡ | ç¦æ­¢ä½¿ç”¨ `#[ignore]` |
| æ— è™šå‡é€šè¿‡ | ç¦æ­¢å®¹é”™æˆ–ç©ºæ–­è¨€ |

### ç¦æ­¢è¡Œä¸º

| è¡Œä¸º | è¯´æ˜ |
|------|------|
| è·³è¿‡æµ‹è¯• | ç¦æ­¢æ¡ä»¶è·³è¿‡æµ‹è¯• |
| å®¹é”™æ–­è¨€ | ç¦æ­¢ `if err { return }` |
| å ä½ç¬¦ | ç¦æ­¢ `todo!()` æˆ–æœªå®ç°å‡½æ•° |
| FFI éªŒè¯ | ç¦æ­¢é€šè¿‡ FFI è°ƒç”¨ C å‡½æ•°éªŒè¯ |

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|---------|
| v1.0.0 | 2025-12-24 | åˆå§‹ç‰ˆæœ¬ï¼Œå®šä¹‰å®Œæ•´å¤åˆ» C ç‰ˆæœ¬çš„æµ‹è¯•ç­–ç•¥ |
| v2.0.0 | 2025-12-24 | å®šä¹‰100%ç²¾ç¡®å¤åˆ»è§„èŒƒï¼šCLIå·¥å…·ã€è¿›ç¨‹APIã€å¿«ç…§æµ‹è¯•ã€å‡½æ•°ç­¾åã€éªŒè¯æ¡ä»¶ |
